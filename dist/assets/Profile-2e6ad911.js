import{r as i,o as Z,l as B,b as r,c as n,e as t,q as T,h as S,s as U,g as k,v as _,f as x,F as V,i as G,d as j,w as $,T as ee,m as D,n as C,t as m}from"./index-fc33451e.js";import{T as te}from"./Toast-c3bd470b.js";const oe={dir:"rtl",class:"bg-gradient-to-br from-orange-50 to-red-50 text-right min-h-screen"},se={class:"container mx-auto px-4 py-8"},re={class:"flex justify-center mb-8"},le={class:"bg-white/80 backdrop-blur-sm rounded-2xl p-2 shadow-xl"},ae={key:0,class:"max-w-2xl mx-auto"},ne={class:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-white/20"},ie=["disabled"],de={key:0,class:"flex items-center justify-center"},ue={key:1},ce={key:1,class:"max-w-2xl mx-auto"},pe={class:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-white/20"},ge={class:"space-y-3 max-h-64 overflow-y-auto"},ve=["onClick"],fe={class:"font-semibold text-gray-800"},me={class:"text-sm text-gray-500"},xe={key:2,class:"max-w-4xl mx-auto"},be={class:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-white/20"},ye={key:0,class:"space-y-6"},he={class:"flex justify-between items-start mb-4"},we={class:"text-lg font-semibold"},ke={class:"text-gray-500"},_e={class:"text-left"},Ce={class:"space-y-2 mb-4"},Me={class:"border-t border-gray-200 pt-4 flex justify-between items-center"},Be={class:"font-semibold"},Te=["onClick"],Se={key:1,class:"text-center py-12"},Ve={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"},je={class:"relative bg-white rounded-3xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},Pe={class:"flex justify-between items-center mb-6"},ze={key:0,class:"mt-4"},Ge={key:1,class:"flex gap-4 mt-6"},Ne={__name:"Profile",setup($e){const v=i({visible:!1,message:"",type:"success"}),u=(o,e="success")=>{v.value={visible:!0,message:o,type:e},setTimeout(()=>v.value.visible=!1,3e3)},h=i(!1);i("");const P=i("");i([]),i({lat:null,lng:null,address:"",title:"home"});const p=i({lat:31.963158,lng:35.930359}),d=i(null),w=i(""),f=i("orders"),E=i(null),M=i(!1),L=(o=null)=>{E.value=o,o?(p.value={lat:o.lat,lng:o.lng},d.value={...p.value},w.value=o.address,M.value=!0):(navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{p.value={lat:e.coords.latitude,lng:e.coords.longitude},d.value={...p.value}},()=>{p.value={lat:31.963158,lng:35.930359}}),d.value=null,w.value="",M.value=!1),h.value=!0,nextTick(()=>initSearchBox())},l=i({name:"",phone:"",email:"",address:"",password:""}),g=i(!1),z=i([]),a=JSON.parse(localStorage.getItem("user")||"{}"),I=async()=>{if(!(a!=null&&a.id)){v.error("لم يتم العثور على مستخدم");return}try{g.value=!0;const o=await C.post("/api/show-user",{lang:"ar",user_id:a.id});if(o.data.key===1){const e=o.data.data;l.value={name:e.first_name||"",phone:e.phone||"",email:e.email||"",address:e.address||""}}}catch(o){console.error("show-user error:",o)}finally{g.value=!1}},F=async()=>{if(!(a!=null&&a.id)){v.error("لم يتم العثور على مستخدم");return}try{g.value=!0;const o=await C.post("/api/show-all-orders",{lang:"ar",user_id:a.id});if(o.data.key===1){const e=o.data.data;z.value=e}else u(o.data.msg||"فشل في جلب البيانات","error")}catch(o){console.error("show-user error:",o),u("فشل الاتصال بالخادم","error")}finally{g.value=!1}},A=i([]),N=async()=>{if(!(a!=null&&a.id)){u("لم يتم العثور على مستخدم","error");return}try{g.value=!0;const o=await C.post("/api/all-addresses",{lang:"ar",user_id:a.id});if(o.data.key===1){const e=o.data.data;A.value=e}else u(o.data.msg||"فشل في جلب البيانات","error")}catch(o){console.error("show-user error:",o),u("فشل الاتصال بالخادم","error")}finally{g.value=!1}},H=async()=>{if(!(a!=null&&a.id)){v.error("لم يتم العثور على مستخدم");return}try{g.value=!0;const o=await C.post("/api/update-user",{lang:"ar",user_id:a.id,first_name:l.value.name,phone:l.value.phone,email:l.value.email,address:l.value.address,password:l.value.password});o.data.key===1?(u(o.data.msg||"تم حفظ البيانات بنجاح","success"),localStorage.setItem("user",JSON.stringify({...a,name:l.value.name,phone:l.value.phone,email:l.value.email,address:l.value.address}))):u(o.data.msg||"فشل في تحديث البيانات","error")}catch(o){console.error("update-user error:",o),u("فشل الاتصال بالخادم","error")}finally{g.value=!1}};function J(o){alert(`سيتم تتبع الطلب ${o}`)}function q(o){switch(o){case"new":return"bg-yellow-100 text-yellow-800";case"active":return"bg-orange-100 text-orange-800";case"finish":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}}function K(o){switch(o){case"new":return"في الانتظار";case"active":return"قيد التحضير";case"finish":return"تم التوصيل";default:return"غير محدد"}}const Q=o=>{d.value={lat:o.latLng.lat(),lng:o.latLng.lng()},O()},R=o=>{d.value={lat:o.latLng.lat(),lng:o.latLng.lng()},O()},O=async()=>{if(!d.value)return;new google.maps.Geocoder().geocode({location:d.value},(e,c)=>{c==="OK"&&e[0]&&(w.value=e[0].formatted_address)})};Z(()=>{I(),F(),N(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(c=>{p.value={lat:c.coords.latitude,lng:c.coords.longitude},d.value={...p.value},console.log(d,"fdfdfdfdfdfdfd")},c=>{console.warn("Geolocation error:",c)});const o=document.getElementById("searchBox");if(!o)return;const e=new google.maps.places.SearchBox(o);e.addListener("places_changed",()=>{const c=e.getPlaces();if(!c||!c.length)return;const b=c[0];b.geometry&&(p.value={lat:b.geometry.location.lat(),lng:b.geometry.location.lng()},d.value={...p.value},w.value=b.formatted_address)})});const W=async()=>{if(!d.value){u("اختر موقعك أولاً","error");return}try{const o=await C.post("/api/store-address",{lang:"ar",user_id:a.id,title:P.value,address:w.value,lat:d.value.lat,lng:d.value.lng});o.data.key===1?(u("تم حفظ العنوان بنجاح","success"),h.value=!1,N()):u(o.data.msg||"خطأ في الحفظ","error")}catch(o){console.error(o),u("فشل الاتصال بالخادم","error")}};return(o,e)=>{const c=B("router-link"),b=B("GMapAutocomplete"),X=B("GMapMarker"),Y=B("GMapMap");return r(),n(V,null,[t("div",oe,[t("div",se,[e[24]||(e[24]=t("h1",{class:"text-4xl font-bold mb-8 text-center bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent"}," الملف الشخصي ",-1)),t("div",re,[t("div",le,[t("button",{onClick:e[0]||(e[0]=s=>f.value="profile"),class:T(["md:px-6 px-3 py-3 rounded-xl font-semibold transition-all",f.value==="profile"?"bg-primary text-white shadow-lg":"text-gray-600 hover:text-primary"])}," البيانات الشخصية ",2),t("button",{onClick:e[1]||(e[1]=s=>f.value="addresses"),class:T(["md:px-6 px-3 py-3 rounded-xl font-semibold transition-all",f.value==="addresses"?"bg-primary text-white shadow-lg":"text-gray-600 hover:text-primary"])}," عناويني ",2),t("button",{onClick:e[2]||(e[2]=s=>f.value="orders"),class:T(["md:px-6 px-3 py-3 rounded-xl font-semibold transition-all",f.value==="orders"?"bg-primary text-white shadow-lg":"text-gray-600 hover:text-primary"])}," طلباتي ",2)])]),f.value==="profile"?(r(),n("div",ae,[t("div",ne,[e[17]||(e[17]=t("h2",{class:"text-2xl font-bold mb-6 flex items-center gap-3"},[t("svg",{class:"w-6 h-6 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),S(" البيانات الشخصية ")],-1)),t("form",{onSubmit:U(H,["prevent"]),class:"space-y-6"},[t("div",null,[e[12]||(e[12]=t("label",{class:"block mb-3 font-semibold text-gray-700"},"الاسم الكامل",-1)),k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.name=s),type:"text",class:"w-full border-2 border-gray-200 rounded-xl px-4 py-4 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"},null,512),[[_,l.value.name]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block mb-3 font-semibold text-gray-700"},"رقم الهاتف",-1)),k(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.phone=s),type:"tel",class:"w-full border-2 border-gray-200 rounded-xl px-4 py-4 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all",style:{direction:"rtl"}},null,512),[[_,l.value.phone]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block mb-3 font-semibold text-gray-700"},"البريد الإلكتروني",-1)),k(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.email=s),type:"email",class:"w-full border-2 border-gray-200 rounded-xl px-4 py-4 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"},null,512),[[_,l.value.email]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block mb-3 font-semibold text-gray-700"},"الرقم السري",-1)),k(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.password=s),type:"password",class:"w-full border-2 border-gray-200 rounded-xl px-4 py-4 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"},null,512),[[_,l.value.password]])]),t("button",{type:"submit",disabled:g.value,class:"w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl font-bold text-lg hover:from-orange-600 hover:to-red-600 transition-all shadow-lg"},[g.value?(r(),n("span",de,e[16]||(e[16]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):(r(),n("span",ue,"حفظ التغييرات"))],8,ie)],32)])])):x("",!0),f.value==="addresses"?(r(),n("div",ce,[t("div",pe,[e[19]||(e[19]=t("h2",{class:"text-2xl font-bold mb-6 flex items-center gap-3"},[t("svg",{class:"w-6 h-6 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),S(" عناويني ")],-1)),t("form",{onSubmit:e[8]||(e[8]=U(()=>{},["prevent"])),class:"space-y-6"},[t("div",null,[e[18]||(e[18]=t("label",{class:"block mb-3 font-semibold text-gray-700"},"الموقع علي الخريطه",-1)),t("div",ge,[(r(!0),n(V,null,G(A.value,s=>(r(),n("div",{key:s.id,onClick:y=>L(s),class:"p-4 border border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition-all hover:border-primary bg-white"},[t("div",fe,m(s.title),1),t("div",me,m(s.address||s.lat+", "+s.lng),1)],8,ve))),128))])]),t("button",{onClick:e[7]||(e[7]=s=>L()),class:"w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl font-bold text-lg hover:from-orange-600 hover:to-red-600 transition-all shadow-lg"}," إضافة عنوان ")],32)])])):x("",!0),f.value==="orders"?(r(),n("div",xe,[t("div",be,[e[23]||(e[23]=t("h2",{class:"text-2xl font-bold mb-6 flex items-center gap-3"},[t("svg",{class:"w-6 h-6 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]),S(" طلباتي ")],-1)),z.value.length?(r(),n("div",ye,[(r(!0),n(V,null,G(z.value,s=>(r(),n("div",{key:s.id,class:"border-2 border-gray-200 rounded-xl md:p-6 p-3 hover:border-primary transition-all"},[t("div",he,[t("div",null,[t("h3",we,"طلب #"+m(s.id),1),t("p",ke,m(s.order_date_time),1)]),t("div",_e,[t("span",{class:T(["px-3 py-1 rounded-full text-sm font-semibold",q(s.status)])},m(K(s.status)),3)])]),t("div",Ce,[(r(!0),n(V,null,G(s.items,y=>(r(),n("div",{key:y.id,class:"flex justify-between"},[t("span",null,m(y.service_title)+" × "+m(y.count),1),t("span",null,m(y.total)+" د.أ",1)]))),128))]),t("div",Me,[t("div",null,[t("span",Be,"الإجمالي: "+m(s.sub_total)+" د.أ",1)]),t("button",{onClick:y=>J(s.id),class:"bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-all"}," تتبع الطلب ",8,Te)])]))),128))])):(r(),n("div",Se,[e[21]||(e[21]=t("div",{class:"text-6xl mb-4"},"📦",-1)),e[22]||(e[22]=t("p",{class:"text-gray-500 text-lg"},"لا توجد طلبات بعد",-1)),j(c,{to:"/",class:"inline-block mt-4 bg-primary text-white px-6 py-3 rounded-xl font-semibold hover:bg-primary-dark transition-all"},{default:$(()=>e[20]||(e[20]=[S(" تصفح المنتجات ",-1)])),_:1,__:[20]})]))])])):x("",!0)])]),j(ee,{name:"fade-slide"},{default:$(()=>[h.value?(r(),n("div",Ve,[t("div",je,[t("div",Pe,[e[25]||(e[25]=t("h3",{class:"text-xl font-bold text-gray-800"},"اختر موقع التوصيل",-1)),t("button",{onClick:e[9]||(e[9]=s=>h.value=!1),class:"text-gray-400 hover:text-gray-700 bg-white rounded-full p-2 shadow-md"}," ✕ ")]),j(b,{placeholder:"This is a placeholder",onPlace_changed:o.setPlace,options:{bounds:{north:1.4,south:1.2,east:104,west:102},strictBounds:!0}},null,8,["onPlace_changed"]),j(Y,{center:p.value,zoom:13,style:{width:"100%",height:"300px"},onClick:R},{default:$(()=>[d.value?(r(),D(X,{key:0,position:d.value,draggable:!0,onDragend:Q},null,8,["position"])):x("",!0)]),_:1},8,["center"]),M.value?x("",!0):(r(),n("div",ze,[k(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>P.value=s),placeholder:"أدخل اسم العنوان (مثلاً: المنزل، المكتب)",class:"w-full border-2 border-gray-200 rounded-2xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[_,P.value]])])),M.value?x("",!0):(r(),n("div",Ge,[t("button",{onClick:W,class:"flex-1 bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-2xl font-semibold"}," حفظ الموقع "),t("button",{onClick:e[11]||(e[11]=s=>h.value=!1),class:"flex-1 bg-gray-200 text-gray-700 py-4 rounded-2xl font-semibold hover:bg-gray-300"}," إلغاء ")]))])])):x("",!0)]),_:1}),v.value.visible?(r(),D(te,{key:0,message:v.value.message,type:v.value.type,visible:v.value.visible},null,8,["message","type","visible"])):x("",!0)],64)}}};export{Ne as default};
